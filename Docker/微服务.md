# 微服务

缘起于虚拟化技术的崛起，属于面向服务的架构（SOA）的一种形式，采用分而治之的思想和逻辑，通过将单一应用程序拆分成一组相互协调配合的微小的服务，为用户提供最终价值。

## 拆分：

【按业务、实体、技术、数据、接口等】前后端分离，无状态服务，RestFul通讯；以及拆分的方式：
    【水平拆分】单节点变多节点，服务池的概念，主要用于【处理大规模高并发的场景】
    【垂直拆分】功能拆分，将复杂功能通过拆分编程一组微笑的服务，主要用于【产品版本的快速迭代，敏捷发布和上线】

## 优点：

​    【开发灵活】不同的业务逻辑可以选择不同的语言或者开发方式去实现；【提高系统可维护性】更加方便地制定每个服务的优化方案；【提高系统资源利用率】降低服务粒度；
​    【去中心化思想】服务之间采用RESTful等轻量级通信协议，相比ESB（企业服务总线）更轻量。

## 缺点：

​    系统服务拆分过多过细，【增加整体系统的治理成本】。
​    【增加系统的复杂性】，服务之间容易形成依赖链，需要有一定的熔断策略，防止服务链条上的雪崩现象出现；
​    【增加系统的部署成本】，需要处理分布式事务、消费调用幂等，通信重试等问题；

## 选择 Go 语言：

​    在【性能】，【易用性】，【生态】方面都具有优势！

## 微服务框架：

​    GoMicro、GoKit

## 微服务部署需要的关键技术：

​    【服务注册和发现】（动态扩容，服务管理）：Consul、Etcd、Zookeeper
​    【远程服务调用】（服务实例之间的交互通信）：同步通信：HTTP、RPC（原生RPC、gRPC）；异步通信：消息队列；
​    【分布式配置中心】（管理分布式系统中各进程的动态配置、热加载）：SpringCloudConfig、Apollo、Disconf
​    【微服务网关】（保护、增强和控制外部请求对于API服务的访问）：Nginx、NetfilxZuul、MashapeKong
​    【容错处理，负载均衡】（提高服务的健壮性和容错能力：多实例部署间负载均衡，暂时性故障的重试、熔断、限流、降级机制）：自定义负载均衡器、Hystrix
​    【统一认证和授权】（多服务系统中对用户行为的统一认证和许可）：OAuth2、分布式Session、JWT
​    【分布式链路追踪】（更直观分析请求链路和理解整个分布式系统、快速定位性能瓶颈、优化服务间依赖）-TwitterZipkin、Uberjaeger、SkyWalking；

## 微服务网关

微服务架构中，网关位于接入层和业务服务层之间，保护微服务；

网关的作用：
    - 1、请求接入（只暴漏指定的端口，通过白名单或者校验规则，对访问进行初步的过滤，内部系统只接受网关转发过来的请求，保护内网的安全，比防火墙更灵活动态）
    - 2、多方的解耦
    - 3、拦截策略（请求的路由转发外，还需要负责安全审计、鉴权、限流和监控）
    - 4、统一管理

流行的API网关：Nginx、Kong、Netflix Zuul；

Nginx，主要用于负载均衡，反向代理，代理缓存、限流。
内核通过查找配置文件与客户端请求进行URL匹配，然后启动不同的模块去完成相应的工作；
启动后，Master和Worker进程通过进程间通信进行交互，采用异步非阻塞的方式来处理请求；
Worker工作进程的阻塞点在I/O多路复用函数调用处（如Select(),Wait()等），以等待发生数据可读/写事件；

Mashape Kong：是Mashape开源的高性能、高可用的API网关和API服务管理层，它是基于Nginx——Lua模块开发的高可用g服务网关，由于Kong是基于Nginx的，所以可以水平扩展多个Kong服务器。通过前置的负载均衡配置把请求均匀地分发到各个Server，来应对大批量的网络请求。