## 什么是微服务？ ##
微服务架构是一种架构模式，属于 SOA（面向服务的架构）的一种形式，它提倡将单一应用程序划分成一组小的服务，服务之间相互协调、互相配合，为用户提供最终价值。

1、微服务架构下服务拆分粒度更细，有利于资源重复（充分）利用，提高开发效率；
2、微服务架构采用去中心化思想，服务之间采用RESTful等轻量级通信协议，相比ESB（企业服务总线）更轻量。这种架构设计，开发者可以更加方便地制定每个服务的额优化方案，提高系统可维护性。也更适用于互联网时代的产品敏捷迭代开发。

微服务设计其实是很早就有的设计思想，但随着虚拟化技术的崛起，微服务可以低成本的实现，所以也开始流行和兴起，微服务的内涵（自动化，去中心化，独立性等等）结合业务的特点，进行更好的选择


## 微服务解决什么问题，又引入了什么问题？ ##
**快速响应、弹性伸缩**
- 针对特定服务发布，影响小，风险小，成本低
- 频繁发布版本，快速交付需求
- 低成本扩容，弹性伸缩，适应云环境
 
**带来的问题** ：
- 分布式系统的复杂性：微服务架构拆分的服务实例如果过多，服务治理成本会极大升高，不利于系统维护；
- 部署，测试和监控的成本问题：服务之间相互依赖，有可能形成复杂的依赖链条，往往单个服务异常，其它服务都会受到影响，出现服务雪崩效应；
- 分布式事务和CAP的相关问题：服务实例之间交互需要处理分布式事务、调用幂等和重试等问题，开发成本高，对团队挑战大；


## 为什么使用 go 构建微服务？ ##
虽然Go是一门新的语言，但是它有很多优势。它更适合多处理器系统和 web 应用程序。继承自 C-family 编程语言，用Go编写的组件更容易与同一家族中其他语言编写的组件相结合。

1. 尽管 Go 出身于 C-family，但它比 C / C ++更高效。它语法更简单，有点像 Python。
1. 它稳定语法, 后向兼容，自第一次公开发布以来，它没有太大变化。
1. Go性能比 python 和 java 高出不少。此外，像 C/C++ 简单的同时又易于阅读和理解，使它成为开发微服务应用的绝佳选择。



**微服务最大的问题：** - 网络不可靠

**客户端如何访问那么多的服务：** - API网关

**服务与服务之间如何通信：**
- 同步通信：HTTP（Apache Http Client）、RPC（Dubbo只支持Java，gRPC）
- 异步通信：消息队列（kafka，RabbitMQ，RocketMQ）

**那么多的服务如何管理：**

- 服务治理：
	- 服务注册和发现
	- 基于客户端的服务注册和发现
		- Apacche Zookeeper
	- 基于服务端的服务注册和发现
		- Netflix Eureka

**服务挂了怎么办：** 重试机制、服务熔断、服务降级、服务降流



## 微服务框架需要哪些技术 ##
- 监控 - 发现故障的征兆 
- 定位问题 - 链路跟踪 
- 分析问题 - 日志分析 
- 网关 - 权限控制，服务治理 
- 服务注册与发现 - 动态扩容
- 熔断、服务降级、限流 



## Golang中的微服务架构框架 ##

### 1、Go Micro ###
最流行的一个可插拔的RPC框架。提供了以下功能:
- 服务发现: 程序自动注册到服务发现系统
- 负载均衡: 它提供了客户端负载均衡，这有助于平衡服务实例之间的请求
- 同步通信: 提供 Request/Response 传输层
- 异步通信: 具有内置的发布和订阅功能
- 消息编码: 可以利用 header 中 Content-Type 进行编码和解码
- RPC客户端/服务器端: 利用上述功能并提供构建微服务需要的接口

![](https://camo.githubusercontent.com/9057599d2bc2d3c79c43423521d71f4ea0851457/68747470733a2f2f6d6963726f2e6d752f646f63732f696d616765732f676f2d6d6963726f2e737667)
[图片](https://camo.githubusercontent.com/9057599d2bc2d3c79c43423521d71f4ea0851457/68747470733a2f2f6d6963726f2e6d752f646f63732f696d616765732f676f2d6d6963726f2e737667)

Go Micro 架构组成：
第一层服务层、
第二层client-server 模型层。serrver 用于编写服务的块组成，而 client 为我们提供接口，其唯一目的是向 server model 中编写的服务发出请求。

第三层插件:
- Broker: 在异步通信中为 message broker(消息代理）提供接口
- Codec: 用于加密或解密消息
- Registry: 提供服务搜索功能
- Selector: 在 register 上构建了负载均衡
- Transport: Transport是服务与服务之间同步请求/响应的通信接口

它还提供了一个名为 Sidecar 的功能。Sidecar 使您能够集成以Go以外的语言编写的服务。它还为我们提供了gRPC编码/解码、服务注册和HTTP 请求处理

### 2、GO Kit ###

是一个用于构建微服务的编程工具包。与 Go Micro不同，它是一个可以以二进制包导入的库。Go Kit 规则很简单。如下:

- 没有全局变量
- 声明式组合
- 显式依赖
- Interface as Contracts (接口合约)
- 领域驱动设计（DDD)


Go Kit 提供以下代码包:

- Authentication 鉴权: BasicAuth 和 JWT
- Transport 协议: HTTP, gRPC 等
- Logging 日志: 服务中的结构化日志接口
- Metrics 度量: CloudWatch,Statsd, Graphite等
- Tracing 分布式追踪: Zipkin and Opentracing
- Service discovery 服务发现: Consul, Etcd, Eureka等
- Circuitbreaker 限流熔断: Hystrix 在 Go 语言的实现


### 3、Kite ###
Kite 是一个在 Go 中开发微服务的框架。它公开RPC client 和 Server 端代码包。创建的服务将自动注册到服务发现系统 Kontrol。Kontrol 是用 Kite 编写的，它本身就是一个 Kite service。这意味着 Kite 微服务在自身的环境中运行良好。如果需要将 Kite 微服务连接到另一个服务发现系统，则需要定制。这是我从列表中选择 Kite 并决定不介绍这个框架的重要原因之一


## 使用微服务应该遵循哪些原则？ ##

**前期阶段**

- 多方沟通，确保符合客户和组织的需求，并得到认同
- 团队沟通，让队友（开发/测试/运维）理解，并积极投入
- 和业务部门沟通，指定版本计划和上线时间

**设计阶段，** 单微服务必须要满足以下的条件，才符合微服务的基本要求：

- 标准的 REST 风格接口（基于 HTTP 和 JSON 格式）
- 独立部署，避免共享数据库（避免因为数据库而影响整个分布式系统）
- 业务上的高内聚，减少依赖（从设计上要避免服务过大或者太小）
 
**微服务涉及哪些基础设施**

- CI/CD和自动化（分布式系统几乎不可能通过人工手动发布）
- 虚拟化技术（要保证微服务运行环境隔离，目前行业主流的是使用 Docker 容器）
- 日志聚合，全链路监控（高度可观察和分析诊断问题）
 



## 假如让你使用微服务架构时，你面临的挑战是什么？ ##

- 开发较小的微服务听起来很容易，但在开发时会经常遇到一些挑战。
- 自动化组件 难以自动化，因为有许多小的组件。对于每个组件，都必须采取构建、发布和监控的步骤；
- 可感知型 将大量组件维持在一起会带来难以部署、维护、监控和识别的问题。它需要在所有组件周围具有很好的感知能力。
- 配置管理 有时在各种环境中维护组件的配置会很困难；
- 调试 很难找到与产生错误相关的每一项服务。维护一个集中式的日志和控制面板对调试问题至关重要；

**微服务的一些核心特性：**
	- 版本化、分布式配置
	- 服务注册和发现
	- 服务与服务之间的调用
	- 路由
	- 断路器和负载均衡
	- 分布式消息传递




